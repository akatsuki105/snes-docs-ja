# オープンバス

メモリ空間からの呼び出しでは、次の場合にMDR(Memory Data Resister)の値が返ってくることがあります。

- 未使用アドレスからの読み出し
- 8ビット未満のレジスタからの読み出し
- （ほとんどの）書き込み専用レジスタからの読み出し

このように、読み出しに対してMDRの値が返ってくるアドレス空間を、オープンバスといいます。

MDRはW65C816プロセッサに存在すると仮定されているレジスタで、MDRの値は、最後にデータバスへ読み書きされた値になります。ほとんどの場合、オペコードの最後のバイト（直接読み出し）、または間接アドレスの上位バイト（間接読み出し）です。

例:

```
  LDA IIJJ,Y   aka MOV A,[IIJJ+Y]  --> garbage = II
  LDA (NN),Y   aka MOV A,[[NN]+Y]  --> garbage = [NN+1]
```

GDMAを使用する場合、おそらくDMAを開始したストアオペコードに依存するでしょう（上記のロードと同様の方法）。HDMAの場合は予測不可能で、MDRの値は現在のオペコードに関連するあらゆる値になります。そして、もし2つのDMA転送が互いに直接続くなら、MDRはおそらく前のDMAから来るでしょう。

Also, in 6502-mode (and maybe also in 65816-mode), the CPU may insert dummy-fetches from unintended addresses on page-wraps?

## PPUのオープンバス

PPUのIOレジスタ(`0x2100..21FF`)のオープンバスは、基本的にCPUと同じ(つまり最後にデータバスに出力されていた値を返す)ですが、一部レジスタは返す値が異なるものがあります。

### PPU1オープンバス

PPU1オープンバスの返す値は、`2134h..2136h, 2138h..213Ah, 213Eh`から直近で読み出した値に依存します。

この記憶された値は、IOレジスタ`21x4h..21x6h`および`21x8h..21xAh`(x=0,1,2)と`STAT77.4`から読み出す際に返されます。

### PPU2オープンバス

PPU2オープンバスの返す値は、`213Bh-213Dh, 213Fh`から直近で読み出した値に依存します。

この記憶された値は、IOレジスタ`213Bh.2nd_read.Bit7`および`213Ch/213Dh.2nd_read.Bits7-1`と`STAT78.5`から読み出す際に返されます。

## DMAのオープンバス

TODO
