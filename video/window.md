# 🪟 ウィンドウ

ウィンドウを使うと、選択した領域のBG/OBJレイヤを無効化したり、選択した領域のカラーマス効果を変更することができます。

次のようにスポットライトのような効果を出したりできます。

<img src="/images/window/example1.png" alt="スーパーマリオコレクション" />&nbsp;&nbsp;<img src="/images/window/example2.png" alt="スーパーマリオワールド クッパの城裏口" />

## 2126h - WHx - Window座標 (W)

```
  2126h: WH0 - Window 1 左座標
  2127h: WH1 - Window 1 右座標
  2128h: WH2 - Window 2 左座標
  2129h: WH3 - Window 2 右座標
```

ウィンドウのX方向の境界を指定します。Y方向の境界はないことに注意してください。

IRQやHDMAでウィンドウレジスタを操作することで、これらの境界を実装することができます。

```
  Bit 7-0   Window座標 (0=左端, 255=右端)
```

ウィンドウ内側の領域はX1からX2まで（X1とX2の座標を含む）なので、ウィンドウの幅はX2-X1+1です。

幅が0（または負）の場合、ウィンドウ内側の領域は空になり、画面全体がウィンドウ外側の領域として扱われます。

## 2123h - WxxSEL - Windowマスク設定 (W)

```
  2123h: W12SEL  - Window BG1/BG2  マスク設定
  2124h: W34SEL  - Window BG3/BG4  マスク設定
  2125h: WOBJSEL - Window OBJ/MATH マスク設定
```

```
  Bit  2123h 2124h 2125h
  0-1  BG1   BG3   OBJ   ウィンドウ1領域 (0..1=無効, 2=内, 3=外)
  2-3  BG1   BG3   OBJ   ウィンドウ2領域 (0..1=無効, 2=内, 3=外)
  4-5  BG2   BG4   MATH  ウィンドウ1領域 (0..1=無効, 2=内, 3=外)
  6-7  BG2   BG4   MATH  ウィンドウ2領域 (0..1=無効, 2=内, 3=外)
```

X1..X2 座標の内側か外側のどちらをウィンドウ領域として扱うかを選択したり、ウィンドウ領域を無効にすることができます。

## 212Ah/212Bh - WBGLOG/WOBJLOG - Window 1/2 マスク処理内容 (W)

```
  Bit  212Ah 212Bh
  0-1  BG1   OBJ   Window 1/2 マスク処理内容 (0=OR, 1=AND, 2=XOR, 3=XNOR)
  2-3  BG2   MATH  Window 1/2 マスク処理内容 (0=OR, 1=AND, 2=XOR, 3=XNOR)
  4-5  BG3   -     Window 1/2 マスク処理内容 (0=OR, 1=AND, 2=XOR, 3=XNOR)
  6-7  BG4   -     Window 1/2 マスク処理内容 (0=OR, 1=AND, 2=XOR, 3=XNOR)
```

ウィンドウ1とウィンドウ2の領域を統合し、最終的に1つのウィンドウ領域にすることができます。統合された領域(最終ウィンドウ領域)は、TMW,TSW,CGWSEL によって利用されます。

このレジスタでは、ウィンドウ1/2の統合をどのようなロジックで行うかを設定します。ロジック(OR/AND/XOR/XNOR)は、`WxxSEL`レジスタで、ウィンドウ1とウィンドウ2 の両方を有効にした場合に適用されます。<sup>[1](#xnor)</sup>

片方のウィンドウだけが有効な場合、そのウィンドウがそのまま最終ウィンドウ領域として使用されます。両方が無効の場合、最終ウィンドウ領域は空になります。

## 212Eh/212Fh - TMW/TSW - ウィンドウ領域無効化 (W)

メイン/サブ画面のウィンドウ領域内のビデオレイヤを無効化することができます。

```
  Bit 0    BG1 (0=無効, 1=有効)
  Bit 1    BG2 (0=無効, 1=有効)
  Bit 2    BG3 (0=無効, 1=有効)
  Bit 3    BG4 (0=無効, 1=有効)
  Bit 4    OBJ (0=無効, 1=有効)
  Bit 5-7  不使用
  Bit -    Backdrop (メイン/サブ両方で常に有効)
```

<sup id="xnor">1: `XNOR` は `Not XOR` のことで、 `!(Win1 XOR Win2)`</sup>
